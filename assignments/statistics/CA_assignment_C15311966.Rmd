---
title: "C15311966 CA notebook"
output:
  html_document:
    df_print: paged
editor_options:
  chunk_output_type: console
  output: html_notebook
---

## Setup
```{r}

needed_packages <- c("pastecs","skimr", "ggplot2", "psych", "semTools", "FSA", "car", "coin", "rstatix", "effectsize", "tidyverse")                      
# Extract not installed packages
not_installed <- needed_packages[!(needed_packages %in% installed.packages()[ , "Package"])]    
# Install not installed packages
if(length(not_installed)) install.packages(not_installed)


library(tidyverse) # useful tooling
library(skimr) # for descriptions
library(ggplot2) # plots
library(pastecs) # for descriptive statistic summaries
library(psych) # useful descriptive functions
library(semTools) #For skewness and kurtosis
library(FSA) #For percentage
library(car) # For Levene's test for homogeneity of variance 
library(effectsize) #To calculate effect size for t-test

student_pref = read_csv("sperformance-dataset.csv")
getmode <- function(v) {
        uniqv <- unique(v)
        uniqv[which.max(tabulate(match(v, uniqv)))]
}
# Hypothesis Question: Does a student’s parents’ level of education influence their level of academic achievement?

```

## H0: There is no difference in students scores in regards to mothers education level.
## HA: There is a difference in students scores in regards to mothers education level.
### tlifesat Examine/Assess Normality
```{r mothers education assessing normality}
gg = ggplot(student_pref, aes(x=Medu))
gg = gg + geom_histogram(bins = 5, colour="cornflowerblue", aes(y=..density.., fill=..count..))
gg = gg + labs(x="Mothers education levels")
#adding a normal curve
#use stat_function to compute a normalized score for each value of Medu
#pass the mean and standard deviation
#use the na.rm parameter to say how missing values are handled
gg = gg + stat_function(fun=dnorm, color="red",args=list(mean=mean(student_pref$Medu, na.rm=TRUE), sd=sd(student_pref$Medu, na.rm=TRUE)))
#to display the graph 
gg

#Create a qqplot for mothers education levels
qqnorm(student_pref$Medu, main = "Mothers education levels")
qqline(student_pref$Medu, col = "blue", lwd = 2)

#stat.desc is a function from pastecs - make sure you include the basic switch=F to ensure you don't get scientific notation
pastecs::stat.desc(student_pref$Medu, basic=F)
dlife = pastecs::stat.desc(student_pref$Medu, basic=F)

#We can make our decision based on the value of the standardized score for skew and kurtosis
#We divide the skew statistic by the standard error to get the standardized score
#This will indicate if we have a problem
edu_skew = semTools::skew(student_pref$Medu)
edu_kurt = semTools::kurtosis(student_pref$Medu)
# skew falls slightly above +/-3 
edu_skew[1]/edu_skew[2]

# kurtosis falls inline with +/-10
edu_kurt[1]/edu_kurt[2]

#and by calculating the percentage of standardized scores for the variable itself that are outside our acceptable range
#This will tell us how big a problem we have
# Calculate the percentage of standardized scores that are greater than 1.96
# the perc function which is part of the FSA package which calculate the percentage that are within a range - you can look for greater than "gt", greater than or equal "geq", "gt", less than or equal "leq",  or less than "lt"),
# scale is a function that creates z scores, abs gets absolute value

mothers_education_level = abs(scale(student_pref$Medu))

FSA::perc(as.numeric(mothers_education_level), 1.96, "gt")
FSA::perc(as.numeric(mothers_education_level), 3.29, "gt")

```
```
Mothers education can be considered to follow a normal distribution, 100% of standardized scores falling within +/- 3.29). Therefore a parametric difference test.
```


```{r student final grade assessing normality}
gg = ggplot(student_pref, aes(x=mG3))
gg = gg + geom_histogram(bins =6, colour="cornflowerblue", aes(y=..density.., fill=..count..))
gg = gg + labs(x="Final student grades")
#adding a normal curve
gg = gg + stat_function(fun=dnorm, color="red", args=list(mean=mean(student_pref$mG3, na.rm=TRUE), sd=sd(student_pref$mG3, na.rm=TRUE)))
#to display the graph 
gg

#Create a qqplot for Final student grades
qqnorm(student_pref$mG3, main = "Final student grades")
qqline(student_pref$mG3, col = "blue", lwd = 2)

pastecs::stat.desc(student_pref$mG3, basic=F)
dlife = pastecs::stat.desc(student_pref$mG3, basic=F)


final_grade_skew = semTools::skew(student_pref$mG3)
efinal_grade_kurt = semTools::kurtosis(student_pref$mG3)
# skew falls above +/-3 
final_grade_skew[1]/final_grade_skew[2]

# kurtosis falls inline with +/-10
efinal_grade_kurt[1]/efinal_grade_kurt[2]


student_grades = abs(scale(student_pref$mG3))

FSA::perc(as.numeric(student_grades), 1.96, "gt")
FSA::perc(as.numeric(student_grades), 3.29, "gt")

```

```
Students final grades can be considered to follow a normal distribution, 100% of standardized scores falling within +/- 3.29). Therefore a parametric difference test.
```


### Differences - Parametric Tests
#### Independent t-test
##### Describe Life Satisfaction by group (have children v do not have children - variable child)
```{r Tests}
# Get descriptive statistics by group - output as a matrix
psych::describeBy(student_pref$Medu, student_pref$mG3, mat=TRUE)

#Conduct Levene's test for homogeneity of variance in library car - the null hypothesis is that variances in groups are equal so to assume homogeneity we woudl expect probaility to not be statistically significant.
car::leveneTest(Medu ~ mG3, data=student_pref)
#Pr(>F) is your probability - in this case it is not statistically significant so we can assume homogeneity


#Conduct the t-test from package stats
#In this case we can use the var.equal = TRUE option to specify equal variances and a pooled variance estimate
stats::t.test(Medu~mG3,var.equal=TRUE,data=student_pref)
#No statistically significant difference was found

res <- stats::t.test(Medu~mG3,var.equal=TRUE,data=student_pref)
#Calculate Cohen's d
#artithmetically
effcd=round((2*res$statistic)/sqrt(res$parameter),2)

#Using function from effectsize package
effectsize::t_to_d(t = res$statistic, res$parameter)


#Eta squared calculation
effes=round((res$statistic*res$statistic)/((res$statistic*res$statistic)+(res$parameter)),3)
effes


```
### Reporting the results with Cohen's d effect

```

```

### Reporting the results with eta squred effect

```

```

